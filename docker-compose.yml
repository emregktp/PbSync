version: '3.8'

services:
  pbsync:
    build: .
    container_name: pbsync
    # Grants full access to devices (needed for loop/fuse)
    privileged: true
    # CRITICAL FOR UBUNTU 24.04: Disables AppArmor for this container
    security_opt:
      - "apparmor:unconfined"
    cap_add:
      - SYS_ADMIN
      - DAC_READ_SEARCH
      - MKNOD
    devices:
      - /dev/fuse:/dev/fuse
      - /dev/loop-control:/dev/loop-control
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
      - /dev:/dev
      - /run/udev:/run/udev:ro
    restart: unless-stopped